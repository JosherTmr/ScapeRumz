function initCanicasGame(roomName,stageName,winToken){let attempts=3;const attemptsDisplay=document.getElementById('attempts');const resultText=document.getElementById('result-text');const parBtn=document.getElementById('par-btn');const imparBtn=document.getElementById('impar-btn');const gameArea=document.getElementById('game-area');function play(playerGuess){if(attempts<=0)return;parBtn.disabled=true;imparBtn.disabled=true;resultText.textContent='La máquina esconde su mano...';resultText.className='lead fw-bold text-white-50';gameArea.innerHTML='<div id="machine-hand" class="display-1">✊</div>';setTimeout(()=>{const machineMarbles=Math.floor(Math.random()*10)+1;const isMachineEven=machineMarbles%2===0;const machineChoice=isMachineEven?'par':'impar';revealMarbles(machineMarbles);if(playerGuess===machineChoice){resultText.textContent=`¡GANASTE! La máquina tenía ${machineMarbles} (${machineChoice}).`;resultText.className='lead fw-bold text-success';setTimeout(()=>submitWin(roomName,stageName,winToken),2000);}else{attempts--;attemptsDisplay.textContent=attempts;resultText.textContent=`PERDISTE. La máquina tenía ${machineMarbles} (${machineChoice}).`;resultText.className='lead fw-bold text-danger';if(attempts<=0){failGame("Te has quedado sin intentos y sin canicas.",roomName);}else{setTimeout(()=>{parBtn.disabled=false;imparBtn.disabled=false;gameArea.innerHTML='<div id="machine-hand" class="display-1">✊</div>';resultText.textContent='Elige de nuevo...';resultText.className='lead fw-bold text-white';},2500);}}},1500);}
function revealMarbles(count){gameArea.innerHTML='';for(let i=0;i<count;i++){const marble=document.createElement('div');marble.className='marble';const colors=['#f44336','#2196f3','#4caf50','#ffeb3b','#9c27b0','#ff9800'];marble.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];gameArea.appendChild(marble);}}
parBtn.addEventListener('click',()=>play('par'));imparBtn.addEventListener('click',()=>play('impar'));}